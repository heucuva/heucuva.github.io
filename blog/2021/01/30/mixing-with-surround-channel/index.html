
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.7">
    
    
      
        <title>Mixing with Surround Channel - Jason's Dev Notes</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.39b8e14a.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../../../stylesheets/dark_theme.css">
    
      <link rel="stylesheet" href="../../../../../stylesheets/codehilite.css">
    
      <link rel="stylesheet" href="../../../../../stylesheets/dark_theme-admonition.css">
    
      <link rel="stylesheet" href="../../../../../stylesheets/pymdownx-highlight.css">
    
    
      
    
    
<meta name="theme-color" content="#212121">

<link rel='icon' href='/assets/images/favicon.ico'>

<meta name='apple-mobile-web-app-capable' content='yes'>
<meta name='mobile-web-app-capable' content='yes'>
<link rel="manifest" href="/manifest.json">

  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="light-green">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../../../.." title="Jason&#39;s Dev Notes" class="md-header-nav__button md-logo" aria-label="Jason's Dev Notes">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Jason's Dev Notes
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Mixing with Surround Channel
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../02/01/new-blog-system/" class="md-tabs__link md-tabs__link--active">
        Blog
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Jason&#39;s Dev Notes" class="md-nav__button md-logo" aria-label="Jason's Dev Notes">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Jason's Dev Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
      
      <label class="md-nav__link" for="nav-2">
        Blog
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Blog" data-md-level="1">
        <label class="md-nav__title" for="nav-2">
          <span class="md-nav__icon md-icon"></span>
          Blog
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../../02/01/new-blog-system/" class="md-nav__link">
        New Blog System (02/01/20)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../31/panning-calculations/" class="md-nav__link">
        Panning Calculations (01/31/20)
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Mixing with Surround Channel (01/30/20)
      </a>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Mixing with Surround Channel (01/30/20)</h1>
                
                <p>While building my tracked music player that's written in Go, <a href="https://github.com/gotracker/gotracker">Gotracker</a>, I noticed that a few formats referred to Surround Sound (specifically, Dolby Pro Logic II). I remember researching how to achieve Pro Logic surround sound encoding a few decades ago, but I didn't recall how to achieve it in source code. Apparently, it's really simple - like, extremely so... or so the Internet would have you believe at first glance.</p>
<p>When you go to do your final mix before heading the audio data out to the sound device, you take your surround channel and mix it into the left channel with a +90&deg; phase and the right channel with a -90&deg; phase. However, it's not exactly as simple as that.</p>
<p>Here's the full process, in brief:
1. The Surround channel is a monaural channel that does not link to any other channels via positional variation - cross-fading with the surround channel might not do what you expect.
2. Before it heads into the bandpass filter in step 3, it needs a -3dB attenuation.
3. A bandpass filter is applied that excludes frequences outside the range between 100Hz and 7000Hz, inclusively.
4. A Dolby <code>B-type</code> noise reduction (or compatible, such as dbx) filter is applied.
5. The result of step 4 is split into two channels, a left at +90&deg; phase shift and a right at -90&deg; phase shift.
6. The final mix occurs with the result of step 5.</p>
<p>In order to be 100% compatible with Pro Logic II, step 4 can't be bypassed. It reduces the fidelity of the audio pretty badly, but it's a fact of dealing with decades-old hardware, I suppose. However, modern implementations of Pro Logic (III and newer) seem to be pretty lenient about how to detect the surround channel out of the left+right channels, so you can probably get by with not implementing the B-type NR and only sometimes get bleed-through of surround audio in the left/right forward channels.</p>
<p>In the process of researching how to write my own, I came across some code that <a href="mailto:derek.john.evans@hotmail.com">Derek J. Evans</a> wrote for a Reaper JS plugin that takes a quad-channel output and generates a Pro Logic II-compatible downmix to stereo - seems pretty much right on the money for my needs:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cm">/*</span>
<span class="cm">** Name: DPLII Quadrophonic Encoder</span>
<span class="cm">** Auth: Derek J. Evans (derek.john.evans@hotmail.com)</span>
<span class="cm">**</span>
<span class="cm">** Desc: Encodes a quadrophonic (4 channel) mix to a DPL/DPLII style stereo signal.</span>
<span class="cm">**       To use, place this effect after a ReaSurround (set to quadrophonic). This encoder</span>
<span class="cm">**       will take 4 channels (1-4) and output a stereo DPL/DPLII mix.</span>
<span class="cm">**       I have tested this encoder on a Kenwood Surround Receiver (KRF-V5560D) which has a licensed</span>
<span class="cm">**       Dolby Prologic II, DTS.   </span>
<span class="cm">** Note: The phase adjust was taken from &quot;JS: Utility/phase_adjust&quot;. Great Code!</span>
<span class="cm">** Date: Monday, 13 January 2014</span>
<span class="cm">*/</span>

<span class="nx">desc</span><span class="o">:</span> <span class="nx">DPLII</span> <span class="nx">Quadrophonic</span> <span class="nx">Encoder</span>

<span class="err">@</span><span class="nx">init</span> 

  <span class="nx">fftsize</span> <span class="o">=</span> <span class="mf">8192</span><span class="p">;</span> 
  <span class="nx">pdc_bot_ch</span> <span class="o">=</span> <span class="mf">0</span><span class="p">;</span>
  <span class="nx">pdc_top_ch</span> <span class="o">=</span> <span class="mf">2</span><span class="p">;</span>
  <span class="nx">pdc_delay</span> <span class="o">=</span> <span class="nx">fftsize</span><span class="p">;</span>

  <span class="c1">// Array Pointers</span>
  <span class="nx">wind</span> <span class="o">=</span> <span class="mf">0</span><span class="p">;</span>
  <span class="nx">buf0</span> <span class="o">=</span> <span class="nx">fftsize</span> <span class="o">*</span> <span class="mf">2</span><span class="p">;</span> <span class="c1">// Rear</span>
  <span class="nx">buf1</span> <span class="o">=</span> <span class="nx">buf0</span> <span class="o">+</span> <span class="nx">buf0</span><span class="p">;</span> 
  <span class="nx">buf2</span> <span class="o">=</span> <span class="nx">buf1</span> <span class="o">+</span> <span class="nx">buf0</span><span class="p">;</span> <span class="c1">// Front</span>
  <span class="nx">buf3</span> <span class="o">=</span> <span class="nx">buf2</span> <span class="o">+</span> <span class="nx">buf0</span><span class="p">;</span> 

  <span class="nx">pos</span> <span class="o">=</span> <span class="mf">0</span><span class="p">;</span> 
  <span class="nx">w</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="nx">$pi</span> <span class="o">/</span> <span class="nx">fftsize</span><span class="p">;</span>
  <span class="nx">i</span> <span class="o">=</span> <span class="mf">0</span><span class="p">;</span>
  <span class="nx">loop</span><span class="p">(</span><span class="nx">fftsize</span> <span class="o">/</span> <span class="mf">2</span><span class="p">,</span>
    <span class="nx">wind</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.42</span> <span class="o">-</span> <span class="mf">0.50</span> <span class="o">*</span> <span class="nx">cos</span><span class="p">(</span><span class="nx">i</span> <span class="o">*</span> <span class="nx">w</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.08</span> <span class="o">*</span> <span class="nx">cos</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="nx">i</span> <span class="o">*</span><span class="nx">w</span><span class="p">);</span>
    <span class="nx">i</span> <span class="o">+=</span> <span class="mf">1</span><span class="p">;</span>
  <span class="p">);</span> 
  <span class="nx">phaseadj</span> <span class="o">=</span> <span class="nx">$pi</span> <span class="o">*</span> <span class="mf">90.0</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">;</span>
  <span class="nx">cadj</span> <span class="o">=</span> <span class="nx">cos</span><span class="p">(</span><span class="nx">phaseadj</span><span class="p">);</span>
  <span class="nx">sadj</span> <span class="o">=</span> <span class="nx">sin</span><span class="p">(</span><span class="nx">phaseadj</span><span class="p">);</span>

  <span class="nx">db0</span> <span class="o">=</span> <span class="nx">sqrt</span><span class="p">(</span> <span class="mf">1</span> <span class="o">/</span>  <span class="mf">2</span><span class="p">);</span>
  <span class="nx">db1</span> <span class="o">=</span> <span class="nx">sqrt</span><span class="p">(</span><span class="mf">19</span> <span class="o">/</span> <span class="mf">25</span><span class="p">);</span>
  <span class="nx">db2</span> <span class="o">=</span> <span class="nx">sqrt</span><span class="p">(</span> <span class="mf">6</span> <span class="o">/</span> <span class="mf">25</span><span class="p">);</span>

<span class="err">@</span><span class="nx">sample</span>

  <span class="nx">pos</span> <span class="o">&gt;=</span> <span class="nx">fftsize</span> <span class="o">?</span> <span class="p">(</span>
    <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">buf0</span><span class="p">;</span> <span class="nx">buf0</span> <span class="o">=</span> <span class="nx">buf1</span><span class="p">;</span> <span class="nx">buf1</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">;</span>
    <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">buf2</span><span class="p">;</span> <span class="nx">buf2</span> <span class="o">=</span> <span class="nx">buf3</span><span class="p">;</span> <span class="nx">buf3</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">;</span>

    <span class="nx">fft</span><span class="p">(</span><span class="nx">buf0</span><span class="p">,</span> <span class="nx">fftsize</span><span class="p">);</span> 
    <span class="nx">fft_permute</span><span class="p">(</span><span class="nx">buf0</span><span class="p">,</span> <span class="nx">fftsize</span><span class="p">);</span>

    <span class="nx">i</span> <span class="o">=</span> <span class="mf">0</span><span class="p">;</span>
    <span class="nx">loop</span><span class="p">(</span><span class="nx">fftsize</span> <span class="o">/</span> <span class="mf">2</span><span class="p">,</span> 
      <span class="nx">a</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
      <span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">+</span> <span class="mf">1</span><span class="p">;</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="nx">buf0</span><span class="p">[</span><span class="nx">a</span><span class="p">];</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="nx">buf0</span><span class="p">[</span><span class="nx">b</span><span class="p">];</span>
      <span class="nx">buf0</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">cadj</span> <span class="o">-</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">sadj</span><span class="p">;</span>
      <span class="nx">buf0</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">sadj</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">cadj</span><span class="p">;</span>

      <span class="nx">a</span> <span class="o">=</span> <span class="mf">2</span> <span class="o">*</span> <span class="nx">fftsize</span> <span class="o">-</span> <span class="nx">i</span> <span class="o">-</span> <span class="mf">2</span><span class="p">;</span>
      <span class="nx">b</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">+</span> <span class="mf">1</span><span class="p">;</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="nx">buf0</span><span class="p">[</span><span class="nx">a</span><span class="p">];</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="nx">buf0</span><span class="p">[</span><span class="nx">b</span><span class="p">];</span>
      <span class="nx">buf0</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span> <span class="o">=</span>  <span class="nx">x</span> <span class="o">*</span> <span class="nx">cadj</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">sadj</span><span class="p">;</span>
      <span class="nx">buf0</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">sadj</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="nx">cadj</span><span class="p">;</span>

      <span class="nx">i</span> <span class="o">+=</span> <span class="mf">2</span><span class="p">;</span>
    <span class="p">);</span>

    <span class="nx">fft_ipermute</span><span class="p">(</span><span class="nx">buf0</span><span class="p">,</span> <span class="nx">fftsize</span><span class="p">);</span> 
    <span class="nx">ifft</span><span class="p">(</span><span class="nx">buf0</span><span class="p">,</span> <span class="nx">fftsize</span><span class="p">);</span>

    <span class="nx">pos</span> <span class="o">=</span> <span class="mf">0</span><span class="p">;</span>
  <span class="p">);</span>

  <span class="nx">w1</span> <span class="o">=</span> <span class="nx">wind</span><span class="p">[</span><span class="nx">pos</span> <span class="o">/</span> <span class="mf">2</span><span class="p">];</span>
  <span class="nx">w2</span> <span class="o">=</span> <span class="nx">wind</span><span class="p">[(</span><span class="nx">fftsize</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2</span> <span class="o">-</span> <span class="mf">1</span><span class="p">];</span>
  <span class="nx">sw</span> <span class="o">=</span> <span class="p">(</span><span class="nx">w1</span> <span class="o">+</span> <span class="nx">w2</span><span class="p">)</span> <span class="o">*</span> <span class="nx">fftsize</span><span class="p">;</span>

  <span class="nx">FL</span> <span class="o">=</span> <span class="nx">buf2</span><span class="p">[</span><span class="nx">pos</span> <span class="o">+</span> <span class="mf">0</span><span class="p">];</span> <span class="c1">// Front Left</span>
  <span class="nx">FR</span> <span class="o">=</span> <span class="nx">buf2</span><span class="p">[</span><span class="nx">pos</span> <span class="o">+</span> <span class="mf">1</span><span class="p">];</span> <span class="c1">// Front Right</span>
  <span class="nx">RL</span> <span class="o">=</span> <span class="p">(</span><span class="nx">buf0</span><span class="p">[</span><span class="nx">pos</span> <span class="o">+</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">buf1</span><span class="p">[</span><span class="nx">pos</span> <span class="o">+</span> <span class="mf">0</span> <span class="o">+</span> <span class="nx">fftsize</span><span class="p">])</span> <span class="o">/</span> <span class="nx">sw</span><span class="p">;</span> <span class="c1">// Rear Left</span>
  <span class="nx">RR</span> <span class="o">=</span> <span class="p">(</span><span class="nx">buf0</span><span class="p">[</span><span class="nx">pos</span> <span class="o">+</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">buf1</span><span class="p">[</span><span class="nx">pos</span> <span class="o">+</span> <span class="mf">1</span> <span class="o">+</span> <span class="nx">fftsize</span><span class="p">])</span> <span class="o">/</span> <span class="nx">sw</span><span class="p">;</span> <span class="c1">// Read Right</span>

  <span class="nx">buf2</span><span class="p">[</span><span class="nx">pos</span> <span class="o">+</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">spl0</span><span class="p">;</span> <span class="c1">// Front Left</span>
  <span class="nx">buf2</span><span class="p">[</span><span class="nx">pos</span> <span class="o">+</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">spl1</span><span class="p">;</span> <span class="c1">// Front Right</span>

  <span class="nx">buf0</span><span class="p">[</span><span class="nx">pos</span> <span class="o">+</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">spl2</span> <span class="o">*</span> <span class="nx">w1</span><span class="p">;</span>
  <span class="nx">buf0</span><span class="p">[</span><span class="nx">pos</span> <span class="o">+</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">spl3</span> <span class="o">*</span> <span class="nx">w1</span><span class="p">;</span>
  <span class="nx">buf1</span><span class="p">[</span><span class="nx">pos</span> <span class="o">+</span> <span class="mf">0</span> <span class="o">+</span> <span class="nx">fftsize</span><span class="p">]</span> <span class="o">=</span> <span class="nx">spl2</span> <span class="o">*</span> <span class="nx">w2</span><span class="p">;</span>
  <span class="nx">buf1</span><span class="p">[</span><span class="nx">pos</span> <span class="o">+</span> <span class="mf">1</span> <span class="o">+</span> <span class="nx">fftsize</span><span class="p">]</span> <span class="o">=</span> <span class="nx">spl3</span> <span class="o">*</span> <span class="nx">w2</span><span class="p">;</span>

  <span class="c1">// Dolby Pro Logic II Encoding Matrix      </span>
  <span class="nx">spl0</span> <span class="o">=</span> <span class="nx">FL</span> <span class="o">-</span> <span class="nx">RL</span> <span class="o">*</span> <span class="nx">db1</span> <span class="o">-</span> <span class="nx">RR</span> <span class="o">*</span> <span class="nx">db2</span><span class="p">;</span> <span class="c1">// Left Total</span>
  <span class="nx">spl1</span> <span class="o">=</span> <span class="nx">FR</span> <span class="o">+</span> <span class="nx">RL</span> <span class="o">*</span> <span class="nx">db2</span> <span class="o">+</span> <span class="nx">RR</span> <span class="o">*</span> <span class="nx">db1</span><span class="p">;</span> <span class="c1">// Right Total</span>

  <span class="nx">pos</span> <span class="o">+=</span> <span class="mf">2</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>
<p>Now to convert it to Go and slot it in somehow...</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../../../.." class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </div>
            </div>
          </a>
        
        
          <a href="../../31/panning-calculations/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Panning Calculations (01/31/20)
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../../assets/javascripts/vendor.53cc9318.min.js"></script>
      <script src="../../../../../assets/javascripts/bundle.e9c9f54f.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../../../../..",
          features: ['navigation.tabs', 'search.suggest', 'toc.integrate'],
          search: Object.assign({
            worker: "../../../../../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>